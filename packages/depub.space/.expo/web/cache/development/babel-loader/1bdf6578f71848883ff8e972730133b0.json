{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport * as React from 'react';\nimport { canUseDOM } from 'fbjs/lib/ExecutionEnvironment';\nimport View from \"../View\";\nimport createElement from \"../createElement\";\nimport StyleSheet from \"../StyleSheet\";\nimport UIManager from \"../UIManager\";\n\nvar FocusBracket = function FocusBracket() {\n  return createElement('div', {\n    accessibilityRole: 'none',\n    tabIndex: 0,\n    style: styles.focusBracket\n  });\n};\n\n_c = FocusBracket;\n\nfunction attemptFocus(element) {\n  if (!canUseDOM) {\n    return false;\n  }\n\n  try {\n    element.focus();\n  } catch (e) {}\n\n  return document.activeElement === element;\n}\n\nfunction focusFirstDescendant(element) {\n  for (var i = 0; i < element.childNodes.length; i++) {\n    var child = element.childNodes[i];\n\n    if (attemptFocus(child) || focusFirstDescendant(child)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction focusLastDescendant(element) {\n  for (var i = element.childNodes.length - 1; i >= 0; i--) {\n    var child = element.childNodes[i];\n\n    if (attemptFocus(child) || focusLastDescendant(child)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nvar ModalFocusTrap = function ModalFocusTrap(_ref) {\n  _s();\n\n  var active = _ref.active,\n      children = _ref.children;\n  var trapElementRef = React.useRef();\n  var focusRef = React.useRef({\n    trapFocusInProgress: false,\n    lastFocusedElement: null\n  });\n  React.useEffect(function () {\n    if (canUseDOM) {\n      var trapFocus = function trapFocus() {\n        if (trapElementRef.current == null || focusRef.current.trapFocusInProgress || !active) {\n          return;\n        }\n\n        try {\n          focusRef.current.trapFocusInProgress = true;\n\n          if (document.activeElement instanceof Node && !trapElementRef.current.contains(document.activeElement)) {\n            var hasFocused = focusFirstDescendant(trapElementRef.current);\n\n            if (focusRef.current.lastFocusedElement === document.activeElement) {\n              hasFocused = focusLastDescendant(trapElementRef.current);\n            }\n\n            if (!hasFocused && trapElementRef.current != null && document.activeElement) {\n              UIManager.focus(trapElementRef.current);\n            }\n          }\n        } finally {\n          focusRef.current.trapFocusInProgress = false;\n        }\n\n        focusRef.current.lastFocusedElement = document.activeElement;\n      };\n\n      trapFocus();\n      document.addEventListener('focus', trapFocus, true);\n      return function () {\n        return document.removeEventListener('focus', trapFocus, true);\n      };\n    }\n  }, [active]);\n  React.useEffect(function () {\n    if (canUseDOM) {\n      var lastFocusedElementOutsideTrap = document.activeElement;\n      return function () {\n        if (lastFocusedElementOutsideTrap && document.contains(lastFocusedElementOutsideTrap)) {\n          UIManager.focus(lastFocusedElementOutsideTrap);\n        }\n      };\n    }\n  }, []);\n  return React.createElement(React.Fragment, null, React.createElement(FocusBracket, null), React.createElement(View, {\n    ref: trapElementRef\n  }, children), React.createElement(FocusBracket, null));\n};\n\n_s(ModalFocusTrap, \"1yN374HQaY5lVDwhxGCoMT5Of9o=\");\n\n_c2 = ModalFocusTrap;\nexport default ModalFocusTrap;\nvar styles = StyleSheet.create({\n  focusBracket: {\n    outlineStyle: 'none'\n  }\n});\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"FocusBracket\");\n$RefreshReg$(_c2, \"ModalFocusTrap\");\n;\n\nvar _a, _b;\n\nif (typeof self !== 'undefined' && '$RefreshHelpers$' in self) {\n  var currentExports = module.__proto__.exports;\n  var prevExports = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevExports) !== null && _b !== void 0 ? _b : null;\n  self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n\n  if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n    module.hot.dispose(function (data) {\n      data.prevExports = currentExports;\n    });\n    module.hot.accept();\n\n    if (prevExports !== null) {\n      if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevExports, currentExports)) {\n        module.hot.invalidate();\n      } else {\n        self.$RefreshHelpers$.scheduleUpdate();\n      }\n    }\n  } else {\n    var isNoLongerABoundary = prevExports !== null;\n\n    if (isNoLongerABoundary) {\n      module.hot.invalidate();\n    }\n  }\n}","map":{"version":3,"sources":["/media/disk1/projects/depub.space/node_modules/react-native-web/dist/exports/Modal/ModalFocusTrap.js"],"names":["FocusBracket","createElement","accessibilityRole","tabIndex","style","styles","element","document","i","child","attemptFocus","focusFirstDescendant","focusLastDescendant","ModalFocusTrap","active","_ref","children","trapElementRef","React","focusRef","trapFocusInProgress","lastFocusedElement","trapFocus","hasFocused","UIManager","lastFocusedElementOutsideTrap","ref","StyleSheet","focusBracket","outlineStyle"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Nicolas Gallagher.\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\nimport * as React from 'react';\nimport { canUseDOM } from 'fbjs/lib/ExecutionEnvironment';\nimport View from '../View';\nimport createElement from '../createElement';\nimport StyleSheet from '../StyleSheet';\nimport UIManager from '../UIManager';\n/**\n * This Component is used to \"wrap\" the modal we're opening\n * so that changing focus via tab will never leave the document.\n *\n * This allows us to properly trap the focus within a modal\n * even if the modal is at the start or end of a document.\n */\n\nvar FocusBracket = function FocusBracket() {\n  return createElement('div', {\n    accessibilityRole: 'none',\n    tabIndex: 0,\n    style: styles.focusBracket\n  });\n};\n\nfunction attemptFocus(element) {\n  if (!canUseDOM) {\n    return false;\n  }\n\n  try {\n    element.focus();\n  } catch (e) {// Do nothing\n  }\n\n  return document.activeElement === element;\n}\n\nfunction focusFirstDescendant(element) {\n  for (var i = 0; i < element.childNodes.length; i++) {\n    var child = element.childNodes[i];\n\n    if (attemptFocus(child) || focusFirstDescendant(child)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction focusLastDescendant(element) {\n  for (var i = element.childNodes.length - 1; i >= 0; i--) {\n    var child = element.childNodes[i];\n\n    if (attemptFocus(child) || focusLastDescendant(child)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nvar ModalFocusTrap = function ModalFocusTrap(_ref) {\n  var active = _ref.active,\n      children = _ref.children;\n  var trapElementRef = React.useRef();\n  var focusRef = React.useRef({\n    trapFocusInProgress: false,\n    lastFocusedElement: null\n  });\n  React.useEffect(function () {\n    if (canUseDOM) {\n      var trapFocus = function trapFocus() {\n        // We should not trap focus if:\n        // - The modal hasn't fully initialized with an HTMLElement ref\n        // - Focus is already in the process of being trapped (e.g., we're refocusing)\n        // - isTrapActive prop being falsey tells us to do nothing\n        if (trapElementRef.current == null || focusRef.current.trapFocusInProgress || !active) {\n          return;\n        }\n\n        try {\n          focusRef.current.trapFocusInProgress = true;\n\n          if (document.activeElement instanceof Node && !trapElementRef.current.contains(document.activeElement)) {\n            // To handle keyboard focusing we can make an assumption here.\n            // If you're tabbing through the focusable elements, the previously\n            // active element will either be the first or the last.\n            // If the previously selected element is the \"first\" descendant\n            // and we're leaving it - this means that we should be looping\n            // around to the other side of the modal.\n            var hasFocused = focusFirstDescendant(trapElementRef.current);\n\n            if (focusRef.current.lastFocusedElement === document.activeElement) {\n              hasFocused = focusLastDescendant(trapElementRef.current);\n            } // If we couldn't focus a new element then we need to focus onto the trap target\n\n\n            if (!hasFocused && trapElementRef.current != null && document.activeElement) {\n              UIManager.focus(trapElementRef.current);\n            }\n          }\n        } finally {\n          focusRef.current.trapFocusInProgress = false;\n        }\n\n        focusRef.current.lastFocusedElement = document.activeElement;\n      }; // Call the trapFocus callback at least once when this modal has been activated.\n\n\n      trapFocus();\n      document.addEventListener('focus', trapFocus, true);\n      return function () {\n        return document.removeEventListener('focus', trapFocus, true);\n      };\n    }\n  }, [active]); // To be fully compliant with WCAG we need to refocus element that triggered opening modal\n  // after closing it\n\n  React.useEffect(function () {\n    if (canUseDOM) {\n      var lastFocusedElementOutsideTrap = document.activeElement;\n      return function () {\n        if (lastFocusedElementOutsideTrap && document.contains(lastFocusedElementOutsideTrap)) {\n          UIManager.focus(lastFocusedElementOutsideTrap);\n        }\n      };\n    }\n  }, []);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(FocusBracket, null), /*#__PURE__*/React.createElement(View, {\n    ref: trapElementRef\n  }, children), /*#__PURE__*/React.createElement(FocusBracket, null));\n};\n\nexport default ModalFocusTrap;\nvar styles = StyleSheet.create({\n  focusBracket: {\n    outlineStyle: 'none'\n  }\n});"]},"metadata":{},"sourceType":"module"}